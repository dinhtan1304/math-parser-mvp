<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Math Exam Parser</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="/static/css/main.css" />
  </head>
  <body>
    <!-- Mobile bar -->
    <div class="mobile-bar">
      <button class="mobile-menu-btn" onclick="toggleSidebar()">
        <svg
          width="22"
          height="22"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M3 6h18M3 12h18M3 18h18" />
        </svg>
      </button>
      <div class="brand-icon">‚àë</div>
      <div class="brand-name">Math Parser</div>
    </div>
    <div
      class="sidebar-overlay"
      id="sidebarOverlay"
      onclick="toggleSidebar()"
    ></div>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <div class="brand-icon">‚àë</div>
          <div class="brand-name">Math Parser</div>
        </div>
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">?</div>
          <div class="user-name" id="userName">ƒêang t·∫£i...</div>
        </div>
      </div>
      <div class="sidebar-section-label">L·ªãch s·ª≠ ph√¢n t√≠ch</div>
      <div class="history-list" id="historyList">
        <div class="history-empty">Ch∆∞a c√≥ b√†i ph√¢n t√≠ch n√†o</div>
      </div>
      <div class="sidebar-footer">
        <button class="logout-btn" onclick="logout()">
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M9 3H5a2 2 0 00-2 2v6a2 2 0 002 2h4M12 7l3 3-3 3M7 10h8" />
          </svg>
          ƒêƒÉng xu·∫•t
        </button>
      </div>
    </nav>

    <!-- Main -->
    <main class="main">
      <div class="main-header">
        <div class="tabs">
          <button
            class="tab-btn active"
            data-tab="dashboard"
            onclick="switchTab('dashboard')"
          >
            <svg
              width="16"
              height="16"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M3 9l4-4 4 4 4-4" />
              <path d="M3 5v14h18V5" />
            </svg>
            Dashboard
          </button>
          <button
            class="tab-btn"
            data-tab="upload"
            onclick="switchTab('upload')"
          >
            <svg
              width="16"
              height="16"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"
              />
            </svg>
            Upload & Parse
          </button>
          <button class="tab-btn" data-tab="bank" onclick="switchTab('bank')">
            <svg
              width="16"
              height="16"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M4 6h16M4 10h16M4 14h10" />
            </svg>
            Ng√¢n h√†ng
            <span class="tab-count" id="bankCount">0</span>
          </button>
          <button
            class="tab-btn"
            data-tab="generate"
            onclick="switchTab('generate')"
          >
            <svg
              width="16"
              height="16"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M12 2L2 12l4 4L16 6zM9 5l4 4" />
            </svg>
            Sinh ƒë·ªÅ
          </button>
        </div>
      </div>

      <div class="main-body">
        <!-- ===== TAB 0: Dashboard ===== -->
        <div class="tab-panel active" id="tabDashboard">
          <!-- Stats Grid -->
          <div class="dash-grid">
            <div class="stat-card">
              <div class="stat-icon">
                <svg
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M4 6h16M4 10h16M4 14h10" />
                </svg>
              </div>
              <div class="stat-value" id="dTotal">-</div>
              <div class="stat-label">T·ªïng c√¢u h·ªèi</div>
              <div class="stat-badge neutral" id="dGrowth">‚Äî</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <svg
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"
                  />
                  <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" />
                </svg>
              </div>
              <div class="stat-value" id="dExams">-</div>
              <div class="stat-label">ƒê·ªÅ ƒë√£ ph√¢n t√≠ch</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <svg
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2zM22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"
                  />
                </svg>
              </div>
              <div class="stat-value" id="dTopics">-</div>
              <div class="stat-label">Ch·ªß ƒë·ªÅ</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <svg
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M12 2L2 12l4 4L16 6zM9 5l4 4" />
                </svg>
              </div>
              <div class="stat-value" id="dNewWeek">-</div>
              <div class="stat-label">C√¢u m·ªõi tu·∫ßn n√†y</div>
            </div>
          </div>

          <!-- Charts Row -->
          <div class="dash-row">
            <div class="dash-card">
              <div class="dash-card-title">
                <svg
                  width="16"
                  height="16"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10" />
                  <path d="M12 2a10 10 0 0110 10" />
                </svg>
                Ph√¢n b·ªë ƒë·ªô kh√≥
              </div>
              <div class="chart-container">
                <canvas id="chartDifficulty"></canvas>
              </div>
            </div>
            <div class="dash-card">
              <div class="dash-card-title">
                <svg
                  width="16"
                  height="16"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M18 20V10M12 20V4M6 20v-6" />
                </svg>
                Top ch·ªß ƒë·ªÅ
              </div>
              <div class="chart-container">
                <canvas id="chartTopics"></canvas>
              </div>
            </div>
          </div>

          <!-- Bottom Row: Activity + Quick Actions -->
          <div class="dash-row">
            <div class="dash-card">
              <div class="dash-card-title">
                <svg
                  width="16"
                  height="16"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10" />
                  <path d="M12 6v6l4 2" />
                </svg>
                Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y
              </div>
              <div class="activity-list" id="activityList">
                <div class="empty-state">
                  <svg
                    width="32"
                    height="32"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                  >
                    <circle cx="16" cy="16" r="14" />
                    <path d="M16 10v6l3 3" />
                  </svg>
                  <p>Ch∆∞a c√≥ ho·∫°t ƒë·ªông</p>
                </div>
              </div>
            </div>
            <div class="dash-card">
              <div class="dash-card-title">
                <svg
                  width="16"
                  height="16"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"
                  />
                  <path d="M13 2v7h7" />
                </svg>
                Thao t√°c nhanh
              </div>
              <div class="quick-actions">
                <button class="quick-btn" onclick="switchTab('upload')">
                  <svg
                    width="16"
                    height="16"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"
                    />
                  </svg>
                  Upload ƒë·ªÅ m·ªõi
                </button>
                <button class="quick-btn" onclick="switchTab('generate')">
                  <svg
                    width="16"
                    height="16"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M12 2L2 12l4 4L16 6zM9 5l4 4" />
                  </svg>
                  Sinh ƒë·ªÅ AI
                </button>
                <button class="quick-btn" onclick="switchTab('bank')">
                  <svg
                    width="16"
                    height="16"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M4 6h16M4 10h16M4 14h10" />
                  </svg>
                  Ng√¢n h√†ng c√¢u h·ªèi
                </button>
                <button class="quick-btn" onclick="switchTab('bank')">
                  <svg
                    width="16"
                    height="16"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="11" cy="11" r="8" />
                    <path d="M21 21l-4.35-4.35" />
                  </svg>
                  T√¨m ki·∫øm c√¢u h·ªèi
                </button>
              </div>

              <!-- Type breakdown -->
              <div class="dash-card-title" style="margin-top: 20px">
                <svg
                  width="16"
                  height="16"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <rect x="3" y="3" width="7" height="7" />
                  <rect x="14" y="3" width="7" height="7" />
                  <rect x="3" y="14" width="7" height="7" />
                  <rect x="14" y="14" width="7" height="7" />
                </svg>
                Lo·∫°i c√¢u h·ªèi
              </div>
              <div class="chart-container" style="height: 140px">
                <canvas id="chartType"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== TAB 1: Upload & Parse ===== -->
        <div class="tab-panel" id="tabUpload">
          <div class="upload-card">
            <div class="upload-dropzone" id="uploadArea">
              <div id="dropzoneDefault">
                <div class="dropzone-icon">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"
                    />
                  </svg>
                </div>
                <p class="dropzone-title">
                  K√©o th·∫£ file ho·∫∑c <span>ch·ªçn t·ª´ m√°y</span>
                </p>
                <p class="dropzone-subtitle">
                  PDF, DOCX, PNG, JPG, TXT ‚Äî t·ªëi ƒëa 50MB
                </p>
              </div>
              <div class="file-preview" id="filePreview">
                <div class="file-thumb" id="fileThumb">üìÑ</div>
                <div class="file-info">
                  <div class="file-name" id="fileName"></div>
                  <div class="file-size" id="fileSize"></div>
                </div>
                <button class="file-remove" id="fileRemove" title="X√≥a file">
                  <svg
                    width="18"
                    height="18"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M18 6L6 18M6 6l12 12" />
                  </svg>
                </button>
              </div>
              <input
                type="file"
                id="fileInput"
                accept=".pdf,.docx,.doc,.png,.jpg,.jpeg,.txt,.md"
              />
            </div>
            <div class="upload-controls">
              <label class="vision-toggle">
                <input type="checkbox" id="visionMode" />
                <div class="toggle-track"></div>
                <span class="toggle-text">Vision mode</span>
              </label>
              <button class="btn-parse" id="uploadBtn" disabled>
                <span class="parse-text">Ph√¢n t√≠ch</span>
                <div class="spinner"></div>
              </button>
            </div>
          </div>

          <div class="progress-card" id="progressSection">
            <div class="progress-label">
              <div class="pulse-dot"></div>
              <span id="progressText">ƒêang x·ª≠ l√Ω...</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
          </div>

          <div class="results-card" id="resultsSection">
            <div class="results-toolbar">
              <div class="results-count" id="resultsCount">
                <span>0</span> c√¢u h·ªèi
              </div>
              <div class="toolbar-actions">
                <button class="btn-toolbar" id="jsonToggle">JSON</button>
                <button class="btn-toolbar primary" id="downloadBtn">
                  T·∫£i xu·ªëng
                </button>
              </div>
            </div>
            <div class="json-panel" id="jsonPanel">
              <pre id="jsonOutput"></pre>
            </div>
            <div class="questions-list" id="questionsContainer"></div>
          </div>
        </div>

        <!-- ===== TAB 2: Question Bank ===== -->
        <div class="tab-panel" id="tabBank">
          <div class="bank-toolbar">
            <div class="bank-stats" id="bankStats">
              <div class="stat-chip">
                <strong id="statTotal">0</strong> c√¢u h·ªèi
              </div>
              <div class="stat-chip">
                <strong id="statTypes">0</strong> d·∫°ng b√†i
              </div>
              <div class="stat-chip">
                <strong id="statTopics">0</strong> ch·ªß ƒë·ªÅ
              </div>
            </div>
            <div class="bank-filters">
              <select class="filter-select" id="filterGrade">
                <option value="">T·∫•t c·∫£ l·ªõp</option>
              </select>
              <select class="filter-select" id="filterChapter">
                <option value="">T·∫•t c·∫£ ch∆∞∆°ng</option>
              </select>
              <select class="filter-select" id="filterType">
                <option value="">T·∫•t c·∫£ d·∫°ng</option>
              </select>
              <select class="filter-select" id="filterTopic">
                <option value="">T·∫•t c·∫£ ch·ªß ƒë·ªÅ</option>
              </select>
              <select class="filter-select" id="filterDiff">
                <option value="">T·∫•t c·∫£ ƒë·ªô kh√≥</option>
              </select>
              <input
                class="filter-input"
                type="text"
                id="filterKeyword"
                placeholder="T√¨m theo n·ªôi dung c√¢u h·ªèi..."
              />
              <button class="btn-filter" onclick="searchBank()">T√¨m</button>
              <button class="btn-reset" onclick="resetFilters()">
                X√≥a l·ªçc
              </button>
            </div>
          </div>

          <div class="bank-results" id="bankResults">
            <div class="bank-results-header">
              <div class="bank-results-count" id="bankResultsCount">
                K·∫øt qu·∫£: <span>0</span> c√¢u
              </div>
              <div class="export-dropdown" id="bankExportDropdown">
                <button
                  class="export-btn"
                  onclick="toggleExportMenu('bankExportMenu')"
                  style="font-size: 0.75rem; padding: 5px 12px"
                >
                  <svg fill="none" stroke="currentColor" stroke-width="2">
                    <path
                      d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"
                    />
                  </svg>
                  Xu·∫•t ‚ñæ
                </button>
                <div class="export-menu" id="bankExportMenu">
                  <button
                    class="export-menu-item"
                    onclick="exportBankAs('pdf')"
                  >
                    <svg fill="none" stroke="currentColor" stroke-width="2">
                      <path
                        d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"
                      />
                      <path d="M14 2v6h6" />
                    </svg>
                    PDF <span class="ext">.pdf</span>
                  </button>
                  <button
                    class="export-menu-item"
                    onclick="exportBankAs('docx')"
                  >
                    <svg fill="none" stroke="currentColor" stroke-width="2">
                      <path
                        d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"
                      />
                      <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" />
                    </svg>
                    Word <span class="ext">.docx</span>
                  </button>
                  <button
                    class="export-menu-item"
                    onclick="exportBankAs('latex')"
                  >
                    <svg fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M4 7V4h16v3M9 20h6M12 4v16" />
                    </svg>
                    LaTeX <span class="ext">.tex</span>
                  </button>
                </div>
              </div>
            </div>
            <div class="bank-questions-list" id="bankQuestionsList"></div>
            <div class="bank-pagination" id="bankPagination"></div>
          </div>
        </div>

        <!-- ===== TAB 3: Generate ===== -->
        <div class="tab-panel" id="tabGenerate">
          <div class="gen-split-layout">
            <!-- LEFT COLUMN: Form + Results -->
            <div class="gen-left-col">
              <div class="gen-form-card">
                <div class="gen-form-title">Ch·∫ø ƒë·ªô sinh ƒë·ªÅ</div>
                <div
                  class="gen-form-grid"
                  style="grid-template-columns: 1fr 1fr; margin-bottom: 16px"
                >
                  <div class="gen-field">
                    <label>Ch·∫ø ƒë·ªô</label>
                    <select id="genMode" onchange="toggleGenMode()">
                      <option value="single">Sinh c√¢u h·ªèi (1 m·ª©c ƒë·ªô)</option>
                      <option value="exam">ƒê·ªÅ ki·ªÉm tra t·ªïng h·ª£p</option>
                    </select>
                  </div>
                  <div class="gen-field">
                    <label>Ch·ªß ƒë·ªÅ</label>
                    <select id="genTopic">
                      <option value="">Ch·ªß ƒë·ªÅ b·∫•t k·ª≥</option>
                    </select>
                  </div>
                </div>

                <!-- Single mode fields -->
                <div id="singleModeFields">
                  <div class="gen-form-grid">
                    <div class="gen-field">
                      <label>D·∫°ng b√†i</label>
                      <select id="genType">
                        <option value="">D·∫°ng b·∫•t k·ª≥</option>
                      </select>
                    </div>
                    <div class="gen-field">
                      <label>ƒê·ªô kh√≥</label>
                      <select id="genDiff">
                        <option value="">ƒê·ªô kh√≥ b·∫•t k·ª≥</option>
                        <option value="NB">NB - Nh·∫≠n bi·∫øt</option>
                        <option value="TH">TH - Th√¥ng hi·ªÉu</option>
                        <option value="VD">VD - V·∫≠n d·ª•ng</option>
                        <option value="VDC">VDC - V·∫≠n d·ª•ng cao</option>
                      </select>
                    </div>
                    <div class="gen-field">
                      <label>S·ªë l∆∞·ª£ng c√¢u</label>
                      <input
                        type="number"
                        id="genCount"
                        value="5"
                        min="1"
                        max="50"
                      />
                    </div>
                  </div>
                </div>

                <!-- Exam mode fields -->
                <div id="examModeFields" style="display: none">
                  <div class="gen-form-grid" style="grid-template-columns: 1fr">
                    <div class="gen-field">
                      <label>D·∫°ng b√†i</label>
                      <select id="genTypeExam">
                        <option value="">K·∫øt h·ª£p TN v√† TL</option>
                        <option value="TN">Ch·ªâ tr·∫Øc nghi·ªám</option>
                        <option value="TL">Ch·ªâ t·ª± lu·∫≠n</option>
                      </select>
                    </div>
                  </div>
                  <div style="margin-top: 12px">
                    <label
                      style="
                        font-size: 0.78rem;
                        font-weight: 600;
                        color: var(--text-secondary);
                        text-transform: uppercase;
                        letter-spacing: 0.03em;
                      "
                      >Ph√¢n b·ªï c√¢u h·ªèi</label
                    >
                    <div
                      class="exam-dist"
                      style="
                        display: grid;
                        grid-template-columns: repeat(4, 1fr);
                        gap: 12px;
                        margin-top: 8px;
                      "
                    >
                      <div class="dist-item">
                        <div
                          class="dist-label"
                          style="
                            font-size: 0.82rem;
                            font-weight: 600;
                            color: #16a34a;
                          "
                        >
                          NB - Nh·∫≠n bi·∫øt
                        </div>
                        <input
                          type="number"
                          id="distNB"
                          value="3"
                          min="0"
                          max="50"
                          class="dist-input"
                          onchange="updateExamTotal()"
                        />
                      </div>
                      <div class="dist-item">
                        <div
                          class="dist-label"
                          style="
                            font-size: 0.82rem;
                            font-weight: 600;
                            color: #2563eb;
                          "
                        >
                          TH - Th√¥ng hi·ªÉu
                        </div>
                        <input
                          type="number"
                          id="distTH"
                          value="3"
                          min="0"
                          max="50"
                          class="dist-input"
                          onchange="updateExamTotal()"
                        />
                      </div>
                      <div class="dist-item">
                        <div
                          class="dist-label"
                          style="
                            font-size: 0.82rem;
                            font-weight: 600;
                            color: #d97706;
                          "
                        >
                          VD - V·∫≠n d·ª•ng
                        </div>
                        <input
                          type="number"
                          id="distVD"
                          value="2"
                          min="0"
                          max="50"
                          class="dist-input"
                          onchange="updateExamTotal()"
                        />
                      </div>
                      <div class="dist-item">
                        <div
                          class="dist-label"
                          style="
                            font-size: 0.82rem;
                            font-weight: 600;
                            color: #dc2626;
                          "
                        >
                          VDC - V·∫≠n d·ª•ng cao
                        </div>
                        <input
                          type="number"
                          id="distVDC"
                          value="2"
                          min="0"
                          max="50"
                          class="dist-input"
                          onchange="updateExamTotal()"
                        />
                      </div>
                    </div>
                    <div
                      class="exam-total"
                      id="examTotal"
                      style="
                        margin-top: 10px;
                        font-size: 0.88rem;
                        font-weight: 600;
                        color: var(--text);
                      "
                    >
                      T·ªïng: 10 c√¢u
                    </div>
                  </div>
                </div>

                <div class="gen-actions" style="margin-top: 16px">
                  <button
                    class="btn-generate"
                    id="genBtn"
                    onclick="doGenerate()"
                  >
                    <span class="gen-btn-text">Sinh ƒë·ªÅ</span>
                    <div class="spinner"></div>
                  </button>
                  <span class="gen-hint" id="genHint"
                    >AI s·∫Ω tham kh·∫£o c√¢u m·∫´u t·ª´ ng√¢n h√†ng ƒë·ªÅ c·ªßa b·∫°n</span
                  >
                </div>
              </div>

              <div class="gen-results" id="genResults">
                <div class="gen-results-header">
                  <div class="gen-results-info" id="genResultsInfo">
                    <span>0</span> cau da sinh
                  </div>
                  <div class="toolbar-actions">
                    <button
                      class="btn-toolbar"
                      onclick="saveGenToBank()"
                      id="btnSaveToBank"
                      style="
                        background: #16a34a;
                        color: white;
                        font-weight: 600;
                      "
                    >
                      üíæ L∆∞u v√†o ng√¢n h√†ng
                    </button>
                    <button class="btn-toolbar" onclick="downloadGenerated()">
                      JSON
                    </button>
                    <div class="export-dropdown" id="genExportDropdown">
                      <button
                        class="export-btn"
                        onclick="toggleExportMenu('genExportMenu')"
                      >
                        <svg fill="none" stroke="currentColor" stroke-width="2">
                          <path
                            d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"
                          />
                        </svg>
                        Xu·∫•t file ‚ñæ
                      </button>
                      <div class="export-menu" id="genExportMenu">
                        <button
                          class="export-menu-item"
                          onclick="exportGenAs('pdf')"
                        >
                          <svg
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path
                              d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"
                            />
                            <path d="M14 2v6h6" />
                          </svg>
                          PDF (in chu·∫©n A4) <span class="ext">.pdf</span>
                        </button>
                        <button
                          class="export-menu-item"
                          onclick="exportGenAs('docx')"
                        >
                          <svg
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path
                              d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"
                            />
                            <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" />
                          </svg>
                          Word (ƒë·ªÅ + ƒë√°p √°n) <span class="ext">.docx</span>
                        </button>
                        <button
                          class="export-menu-item"
                          onclick="exportGenAs('docx-split')"
                        >
                          <svg
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path
                              d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"
                            />
                            <path
                              d="M15 2H9a1 1 0 00-1 1v2a1 1 0 001 1h6a1 1 0 001-1V3a1 1 0 00-1-1z"
                            />
                          </svg>
                          Word (ƒë·ªÅ ri√™ng / ƒë√°p √°n ri√™ng)
                          <span class="ext">.zip</span>
                        </button>
                        <div class="export-menu-sep"></div>
                        <button
                          class="export-menu-item"
                          onclick="exportGenAs('latex')"
                        >
                          <svg
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path d="M4 7V4h16v3M9 20h6M12 4v16" />
                          </svg>
                          LaTeX <span class="ext">.tex</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="gen-results-list" id="genResultsList"></div>
              </div>
            </div>
            <!-- /gen-left-col -->

            <!-- RIGHT COLUMN: PDF Preview (hidden until results) -->
            <div
              class="gen-right-col"
              id="genPreviewPanel"
              style="display: none"
            >
              <div class="gen-preview-header" id="genPreviewHeader">
                <div class="preview-header-left">
                  <svg
                    width="16"
                    height="16"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    viewBox="0 0 24 24"
                  >
                    <path
                      d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"
                    />
                    <path d="M14 2v6h6" />
                  </svg>
                  <span>Xem tr∆∞·ªõc ƒë·ªÅ thi</span>
                </div>
                <div class="preview-header-actions">
                  <label class="preview-toggle"
                    ><input
                      type="checkbox"
                      id="previewAnswers"
                      checked
                      onchange="refreshPreview()"
                    /><span>ƒê√°p √°n</span></label
                  >
                  <label class="preview-toggle"
                    ><input
                      type="checkbox"
                      id="previewSolutions"
                      checked
                      onchange="refreshPreview()"
                    /><span>L·ªùi gi·∫£i</span></label
                  >
                  <button
                    class="preview-print-btn"
                    onclick="printPreview()"
                    title="In / L∆∞u PDF"
                  >
                    <svg
                      width="14"
                      height="14"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      viewBox="0 0 24 24"
                    >
                      <path
                        d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"
                      />
                      <rect x="6" y="14" width="12" height="8" />
                    </svg>
                    In PDF
                  </button>
                </div>
              </div>
              <iframe id="genPreviewFrame" class="gen-preview-frame"></iframe>
            </div>
            <!-- /gen-right-col -->
          </div>
          <!-- /gen-split-layout -->
        </div>
      </div>
    </main>

    <!-- ‚îÄ‚îÄ Edit Question Modal (Sprint 2 Task 11) ‚îÄ‚îÄ -->
    <div class="modal-overlay" id="editModal">
      <div class="modal-box">
        <div class="modal-header">
          <span>‚úèÔ∏è S·ª≠a c√¢u h·ªèi</span>
          <button class="modal-close" onclick="closeEditModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="editQId" />
          <div class="modal-field">
            <label>N·ªôi dung c√¢u h·ªèi (h·ªó tr·ª£ LaTeX: $...$)</label>
            <textarea id="editQText" rows="4"></textarea>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px">
            <div class="modal-field">
              <label>D·∫°ng b√†i</label>
              <input
                type="text"
                id="editQType"
                placeholder="TN, TL, R√∫t g·ªçn..."
              />
            </div>
            <div class="modal-field">
              <label>ƒê·ªô kh√≥</label>
              <select id="editQDiff">
                <option value="NB">NB ‚Äî Nh·∫≠n bi·∫øt</option>
                <option value="TH">TH ‚Äî Th√¥ng hi·ªÉu</option>
                <option value="VD">VD ‚Äî V·∫≠n d·ª•ng</option>
                <option value="VDC">VDC ‚Äî V·∫≠n d·ª•ng cao</option>
              </select>
            </div>
          </div>
          <div class="modal-field">
            <label>Ch·ªß ƒë·ªÅ</label>
            <input
              type="text"
              id="editQTopic"
              placeholder="ƒê·∫°i s·ªë, H√¨nh h·ªçc..."
            />
          </div>
          <div
            style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px"
          >
            <div class="modal-field">
              <label>L·ªõp</label>
              <select id="editQGrade">
                <option value="">‚Äî</option>
                <option value="6">L·ªõp 6</option>
                <option value="7">L·ªõp 7</option>
                <option value="8">L·ªõp 8</option>
                <option value="9">L·ªõp 9</option>
                <option value="10">L·ªõp 10</option>
                <option value="11">L·ªõp 11</option>
                <option value="12">L·ªõp 12</option>
              </select>
            </div>
            <div class="modal-field" style="grid-column: span 2">
              <label>Ch∆∞∆°ng</label>
              <input
                type="text"
                id="editQChapter"
                placeholder="Ch∆∞∆°ng I. ·ª®ng d·ª•ng ƒë·∫°o h√†m..."
              />
            </div>
          </div>
          <div class="modal-field">
            <label>Ti√™u ƒë·ªÅ b√†i</label>
            <input
              type="text"
              id="editQLesson"
              placeholder="T√≠nh ƒë∆°n ƒëi·ªáu v√† c·ª±c tr·ªã..."
            />
          </div>
          <div class="modal-field">
            <label>ƒê√°p √°n</label>
            <textarea id="editQAnswer" rows="2"></textarea>
          </div>
          <div class="modal-field">
            <label>L·ªùi gi·∫£i (JSON array, m·ªói b∆∞·ªõc 1 string)</label>
            <textarea
              id="editQSteps"
              rows="3"
              placeholder='["B∆∞·ªõc 1: ...", "B∆∞·ªõc 2: ..."]'
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="modal-btn" onclick="closeEditModal()">H·ªßy</button>
          <button
            class="modal-btn primary"
            id="editSaveBtn"
            onclick="submitEdit()"
          >
            L∆∞u thay ƒë·ªïi
          </button>
        </div>
      </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <!-- KaTeX -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- App modules (Sprint 3, Task 17) -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/parser.js"></script>
    <script src="/static/js/bank.js"></script>
    <script src="/static/js/generator.js"></script>
  </body>
</html>
